
var members = TAFFY();
members.insert([{id: 1, name:"Sirpa Pietikäinen", party:"KOK"},
{id: 2, name:"Petri Sarvamaa", party:"KOK"},
{id: 3, name:"Alexander Stubb", party:"KOK"},
{id: 4, name:"Henna Virkkunen", party:"KOK"},
{id: 5, name:"Jussi Halla-aho", party:"PS"},
{id: 6, name:"Pirkko Ruohonen-Lerner", party:"PS"},
{id: 7, name:"Sampo Terho", party:"PS"},
{id: 8, name:"Anneli Jäätteenmäki", party:"KESK"},
{id: 9, name:"Olli Rehn", party:"KESK"},
{id: 10, name:"Hannu Takkula", party:"KESK"},
{id: 11, name:"Paavo Väyrynen", party:"KESK"},
{id: 12, name:"Christina Gestrin", party:"RKP"},
{id: 13, name:"Nils Torvalds", party:"RKP"},
{id: 14, name:"Timo Harakka", party:""},
{id: 15, name:"Liisa Jaakonsaari", party:""},
{id: 16, name:"Miapetra Kumpula-Natri", party:""},
{id: 17, name:"Li Andersson", party:"VAS"},
{id: 18, name:"Merja Kyllönen", party:"VAS"},
{id: 19, name:"Heidi Hautala", party:"VIHR"},
{id: 20, name:"Oras Tynkkynen", party:"VIHR"}]);


var omatvarat = TAFFY();
omatvarat.insert([
{id:1,member:1,sum:49147.98},
{id:2,member:2,sum:12680.49}]);

var lainarahat = TAFFY();
lainarahat.insert([
{id:1,member:1,sum:60000},
{id:2,member:2,sum:0}]);

var henkilotuki = TAFFY();
henkilotuki.insert([
{id:1,member:1,sum:6558},
{id:2,member:2,sum:17007}
]);

var yritystuki = TAFFY();
yritystuki.insert([
{id:1,member:1,sum:33382},
{id:2,member:2,sum:10320}
]);

var puolueyhdistystuki = TAFFY();
puolueyhdistystuki.insert([
{id:1,member:1,sum:5401.21},
{id:2,member:2,sum:0}
]);

var muutuki = TAFFY();
muutuki.insert([
{id:1,member:1,sum:29212},
{id:2,member:2,sum:6210}
]);



var parties = TAFFY();
parties.insert([{id:1,abbreviation:"KOK",name:"Kansallinen Kokoomus"},
{id:2,abbreviation:"SDP",name:"Suomen Sosialidemokraattinen Puolue"},
{id:3,abbreviation:"VIHR",name:"Vihreä liitto"},
{id:4,abbreviation:"VAS",name:"Vasemmistoliitto"},
{id:5,abbreviation:"PS",name:"Perussuomalaiset"},
{id:6,abbreviation:"KESK",name:"Suomen Keskusta"},
{id:7,abbreviation:"RKP",name:"Ruotsalainen kansanpuolue"},
{id:8,abbreviation:"KD",name:"Suomen Kristillisdemokraatit"},
{id:9,abbreviation:"SVR",name:"Sinivalkoinen Rintama"}]);



// wgt 37

Raphael.fn.animateViewBox = function animateViewBox( x, y, w, h, duration, easing_function, callback )
{
    var cx = this._viewBox ? this._viewBox[0] : 0,
        dx = x - cx,
        cy = this._viewBox ? this._viewBox[1] : 0,
        dy = y - cy,
        cw = this._viewBox ? this._viewBox[2] : this.width,
        dw = w - cw,
        ch = this._viewBox ? this._viewBox[3] : this.height,
        dh = h - ch,
        self = this;;
    easing_function = easing_function || "linear";
 
    var interval = 25;
    var steps = duration / interval;
    var current_step = 0;
    var easing_formula = Raphael.easing_formulas[easing_function];
 
    var intervalID = setInterval( function()
        {
            var ratio = current_step / steps;
            self.setViewBox( cx + dx * easing_formula( ratio ),
                             cy + dy * easing_formula( ratio ),
                             cw + dw * easing_formula( ratio ),
                             ch + dh * easing_formula( ratio ), false );
            if ( current_step++ >= steps )
            {
                clearInterval( intervalID );
                callback && callback();
            }
        }, interval );
}










//c = members({party:"KOK"}).count();

var dba = members().join(parties, ['party', '===','abbreviation']);


window.onload = function() {

 var canvaswidth = 1000;
 var canvasheight = 1000;

 var paper = new Raphael(funding, canvaswidth, canvasheight); // holder, width, height

 var radius = 100;
 var namerad = 1.7;

 var phi = 0;
 var reps = 10;
 var xpos = 0;
 var ypos = 0;
 var increment = 2 * Math.PI / reps;
 var phi = 0;

 var circ = {};

 var council = {};

 council.member = new Array();


// placing data for members

 for(var j = 0; j <= reps; j++){

  council.member[j] = members({id:j+1}).first();

  council.member[j].xpos = canvaswidth/2 + radius * Math.cos(phi);
  council.member[j].ypos = canvasheight/2 + radius * Math.sin(phi);
  council.member[j].phi = phi;
  xpos = canvaswidth/2 + radius * Math.cos(phi);
  ypos = canvasheight/2 + radius * Math.sin(phi);

  phi += increment;

 }


// draw the circle

 for(var j = 0; j < reps; j++){

  var circ = paper.circle(council.member[j].xpos,council.member[j].ypos,10);
  circ.attr("fill", "#f00");
  circ.name = council.member[j].name;
  circ.party = council.member[j].party;
  circ.phi = council.member[j].phi;

  circ.txpos = canvaswidth/2 + namerad * radius * Math.cos(council.member[j].phi);
  circ.typos = canvaswidth/2 + namerad * radius * Math.sin(council.member[j].phi);

//  var t = paper.text(txpos, typos, council.member[j].name).attr("fill", "#f00", "font-size", 2);
//  var t = paper.text(txpos, typos+10, council.member[j].party).attr("fill", "#f00", "font-size", 2);


  


// dg 40
// for(var j = 0; j < reps; j++){

  circ.mouseover(function(evt){

//   var txpos = canvaswidth/2 + namerad * radius * Math.cos(council.member[j].phi);
//    var typos = canvaswidth/2 + namerad * radius * Math.sin(council.member[j].phi);

//    var t = paper.text(txpos, typos, council.member[j].name).attr("fill", "#f00", "font-size", 5);
//    var t = paper.text(txpos, typos+10, council.member[j].party).attr("fill", "#f00", "font-size", 5);

    var t = paper.text(this.txpos, this.typos, this.name).attr("fill", "#f00", "font-size", 5);
    var t = paper.text(this.txpos, this.typos+10, this.party).attr("fill", "#f00", "font-size", 5);


    this.attr("fill", "#a00");
  });

  circ.mouseout(function(evt){
//    var a = members({id:j}).first();
//this.text(xpos, ypos, a.name).attr("fill", "#f00");
//var t = paper.text(this.xpos+50, this.ypos, this.name).attr("fill", "#aaa");

    var txpos = canvaswidth/2 + namerad * radius * Math.cos(this.phi);
    var typos = canvasheight/2 + namerad * radius * Math.sin(this.phi);
    var t = paper.text(this.txpos, this.typos, this.name).attr("fill", "#ffffff");
    this.attr("fill", "#f00");

  });

  circ.click(function(){

    var closeup = function(){
               paper.setViewBox(canvaswidth/10 + this.xpos - radius/10,
                                canvasheight/20 + this.ypos - radius/10,
                                canvaswidth/10 + this.xpos + radius/10,
                                canvasheight/20 + this.ypos + radius/10, false);
    };


  paper.setViewBox(council.member[j].xpos - 30, council.member[j].ypos - 30, 100, 50, false);

// placement of the returnlink
  var returnlink = paper.text(council.member[j].xpos - 15, council.member[j].ypos - 18, "\u2190 Takaisin").attr({"font": 'Arial',"font-size": 1, stroke: "none", fill: "#aaa", "text-anchor": "start"});



// previous gives zoom, this does not
//  paper.setViewBox(this.xpos - 30, this.ypos - 30, 100, 50, false);
//  var returnlink = paper.text(this.xpos - 15, this.ypos - 18, "\u2190 Takaisin").attr({"font": 'Arial',"font-size": 1, stroke: "none", fill: "#aaa", "text-anchor": "start"});

  returnlink.click(closeup);




  });

}


// }// for 


// http://stackoverflow.com/questions/8417089/svg-viewbox-zoom-in-center-raphael

paper.setViewBox(canvaswidth/2 - 200, canvasheight/2 - 200, 500, 500, false); // viewboxX, viewboxY, viewboxwidth, viewboxheight
/*
paper.animateViewBox( 25, 25, 50, 50, 2500, "<>", function()
    {
        paper.animateViewBox( 450, 550, 450, 450, 2500, "bounce", function()
            {
                alert("All done!" );
            } );
    } );
*/

var mapMenuHolderWidth = 40;
var mapMenuHolderHeight = 216;
var mapMenuHolderX = mapWidth - mapMenuHolderWidth - 6; 
var mapMenuHolderY = 5; 

var mapMenuHolder = paper.rect(mapMenuHolderX, mapMenuHolderY, mapMenuHolderWidth, mapMenuHolderHeight, 12).attr({fill: 'black', stroke: '#aaa', 'stroke-width': 2, opacity: 0.7});




var maxIcon = paper.path("M22.646,19.307c0.96-1.583,1.523-3.435,1.524-5.421C24.169,8.093,19.478,3.401,13.688,3.399C7.897,3.401,3.204,8.093,3.204,13.885c0,5.789,4.693,10.481,10.484,10.481c1.987,0,3.839-0.563,5.422-1.523l7.128,7.127l3.535-3.537L22.646,19.307zM13.688,20.369c-3.582-0.008-6.478-2.904-6.484-6.484c0.006-3.582,2.903-6.478,6.484-6.486c3.579,0.008,6.478,2.904,6.484,6.486C20.165,17.465,17.267,20.361,13.688,20.369zM15.687,9.051h-4v2.833H8.854v4.001h2.833v2.833h4v-2.834h2.832v-3.999h-2.833V9.051z").attr({fill: "#bbb", stroke: "#000", translation: (mapMenuHolderX+5) + ', '+(mapMenuHolderY + 10)});
var minIcon = paper.path("M22.646,19.307c0.96-1.583,1.523-3.435,1.524-5.421C24.169,8.093,19.478,3.401,13.688,3.399C7.897,3.401,3.204,8.093,3.204,13.885c0,5.789,4.693,10.481,10.484,10.481c1.987,0,3.839-0.563,5.422-1.523l7.128,7.127l3.535-3.537L22.646,19.307zM13.688,20.369c-3.582-0.008-6.478-2.904-6.484-6.484c0.006-3.582,2.903-6.478,6.484-6.486c3.579,0.008,6.478,2.904,6.484,6.486C20.165,17.465,17.267,20.361,13.688,20.369zM8.854,11.884v4.001l9.665-0.001v-3.999L8.854,11.884z").attr({fill: "#bbb", stroke: "#000", translation: (mapMenuHolderX+5) + ', '+(mapMenuHolderY + 7+ 34)});
var arrowTop = paper.path("M239.918,118.73c-0.001,0.001-1.773,2.879-1.773,2.879c-1.861,3.023-18.787,30.315-39.705,57.427 c-29.781,38.601-51.503,56.577-68.363,56.577l0,0c-16.859,0-38.582-17.977-68.362-56.577 c-20.96-27.165-37.851-54.41-39.707-57.427l-1.774-2.881c-1.58-2.565-1.648-5.794-0.177-8.425 c1.469-2.63,4.255-4.264,7.267-4.264c0,0,42.486,0,48.73,0c0-6.507,0-69.324,0-69.324c0-4.591,3.734-8.325,8.325-8.325l91.397-0.001c4.59,0,8.324,3.735,8.324,8.325c0,0,0,62.817,0,69.325c6.244,0,48.73,0,48.73,0c3.014,0,5.799,1.635,7.268,4.266 C241.567,112.933,241.5,116.162,239.918,118.73z").attr({fill: "#bbb", stroke: "#000", scale: 0.10, translation: '245, -25', rotation: 180});
var arrowLeft = paper.path("M239.918,118.73c-0.001,0.001-1.773,2.879-1.773,2.879c-1.861,3.023-18.787,30.315-39.705,57.427 c-29.781,38.601-51.503,56.577-68.363,56.577l0,0c-16.859,0-38.582-17.977-68.362-56.577 c-20.96-27.165-37.851-54.41-39.707-57.427l-1.774-2.881c-1.58-2.565-1.648-5.794-0.177-8.425 c1.469-2.63,4.255-4.264,7.267-4.264c0,0,42.486,0,48.73,0c0-6.507,0-69.324,0-69.324c0-4.591,3.734-8.325,8.325-8.325l91.397-0.001c4.59,0,8.324,3.735,8.324,8.325c0,0,0,62.817,0,69.325c6.244,0,48.73,0,48.73,0c3.014,0,5.799,1.635,7.268,4.266 C241.567,112.933,241.5,116.162,239.918,118.73z").attr({fill: "#bbb", stroke: "#000", scale: 0.10, translation: '245, 4', rotation: 90});
var arrowRight = paper.path("M239.918,118.73c-0.001,0.001-1.773,2.879-1.773,2.879c-1.861,3.023-18.787,30.315-39.705,57.427 c-29.781,38.601-51.503,56.577-68.363,56.577l0,0c-16.859,0-38.582-17.977-68.362-56.577 c-20.96-27.165-37.851-54.41-39.707-57.427l-1.774-2.881c-1.58-2.565-1.648-5.794-0.177-8.425 c1.469-2.63,4.255-4.264,7.267-4.264c0,0,42.486,0,48.73,0c0-6.507,0-69.324,0-69.324c0-4.591,3.734-8.325,8.325-8.325l91.397-0.001c4.59,0,8.324,3.735,8.324,8.325c0,0,0,62.817,0,69.325c6.244,0,48.73,0,48.73,0c3.014,0,5.799,1.635,7.268,4.266 C241.567,112.933,241.5,116.162,239.918,118.73z").attr({fill: "#bbb", stroke: "#000", scale: 0.10, translation: '245, 33', rotation: -90});
var arrowBottom = paper.path("M239.918,118.73c-0.001,0.001-1.773,2.879-1.773,2.879c-1.861,3.023-18.787,30.315-39.705,57.427 c-29.781,38.601-51.503,56.577-68.363,56.577l0,0c-16.859,0-38.582-17.977-68.362-56.577 c-20.96-27.165-37.851-54.41-39.707-57.427l-1.774-2.881c-1.58-2.565-1.648-5.794-0.177-8.425 c1.469-2.63,4.255-4.264,7.267-4.264c0,0,42.486,0,48.73,0c0-6.507,0-69.324,0-69.324c0-4.591,3.734-8.325,8.325-8.325l91.397-0.001c4.59,0,8.324,3.735,8.324,8.325c0,0,0,62.817,0,69.325c6.244,0,48.73,0,48.73,0c3.014,0,5.799,1.635,7.268,4.266 C241.567,112.933,241.5,116.162,239.918,118.73z").attr({fill: "#bbb", stroke: "#000", scale: 0.10, translation: '245, 63'});

maxIcon.mouseover(menuItemsMouseOver); maxIcon.mouseout(menuItemsMouseOut);
minIcon.mouseover(menuItemsMouseOver); minIcon.mouseout(menuItemsMouseOut);
arrowTop.mouseover(menuItemsMouseOver); arrowTop.mouseout(menuItemsMouseOut);
arrowBottom.mouseover(menuItemsMouseOver); arrowBottom.mouseout(menuItemsMouseOut);
arrowLeft.mouseover(menuItemsMouseOver); arrowLeft.mouseout(menuItemsMouseOut);
arrowRight.mouseover(menuItemsMouseOver); arrowRight.mouseout(menuItemsMouseOut);
maxIcon.mousedown(menuItemsMouseDown); maxIcon.mouseup(menuItemsMouseOver);
minIcon.mousedown(menuItemsMouseDown); minIcon.mouseup(menuItemsMouseOver);
arrowTop.mousedown(menuItemsMouseDown); arrowTop.mouseup(menuItemsMouseOver);
arrowBottom.mousedown(menuItemsMouseDown); arrowBottom.mouseup(menuItemsMouseOver);
arrowLeft.mousedown(menuItemsMouseDown); arrowLeft.mouseup(menuItemsMouseOver);
arrowRight.mousedown(menuItemsMouseDown); arrowRight.mouseup(menuItemsMouseOver);
$(mapMenuHolder.node).mousemove(function(e){ e.stopPropagation(); });
$(mapMenuHolder.node).mousedown(function(e){ e.stopPropagation(); });
maxIcon.click(function(e){
mapZoom++;
mapImage.scale(mapZoom, mapZoom);
e.stopPropagation();
e.preventDefault();
});
minIcon.click(function(e){
if (mapZoom == 1) return;
mapZoom--;
mapImage.scale(mapZoom, mapZoom);
adjustMapEdge();
e.stopPropagation();
e.preventDefault();
});
arrowTop.click(function(e){
mapImage.translate(0, 20);
adjustMapEdge();
e.stopPropagation();
e.preventDefault();
});
arrowBottom.click(function(e){
mapImage.translate(0, -20);
adjustMapEdge();
e.stopPropagation();
e.preventDefault();
});
arrowLeft.click(function(e){
mapImage.translate(20, 0);
adjustMapEdge();
e.stopPropagation();
e.preventDefault();
});
arrowRight.click(function(e){
mapImage.translate(-20, 0);
adjustMapEdge();
e.stopPropagation();
e.preventDefault();
});
var adjustMapEdge = function()
{
if (mapImage.attr('x') > 0) mapImage.attr({'x': 0});
if (mapImage.attr('x') < (mapWidth - mapImage.attr('width'))) mapImage.attr({'x': (mapWidth - mapImage.attr('width'))});
if (mapImage.attr('y') > 0) mapImage.attr({'y': 0});
if (mapImage.attr('y') < (mapHeight - mapImage.attr('height') )) mapImage.attr({'y': (mapHeight - mapImage.attr('height') )});
};
$('#mapHolder').mousedown(function(e){
clicking = true;
lastX = e.pageX;
lastY = e.pageY;
$('#mapHolder').css('cursor', 'move');
e.stopPropagation();
e.preventDefault();
});
$(document).mouseup(function(e){
clicking = false;
$('#mapHolder').css('cursor', 'default');
e.stopPropagation();
e.preventDefault();
});
$('#mapHolder').mousemove(function(e){
if(clicking == false) return;
var currentMapPosX = 0, currentMapPosY = 0;
if ((mapImage.attr('x') <= 0) && (mapImage.attr('x') >= (mapWidth - mapImage.attr('width'))))
{
currentMapPosX = e.pageX - lastX;
}
if ((mapImage.attr('y') <= 0) && (mapImage.attr('y') >= (mapHeight - mapImage.attr('height'))))
{
currentMapPosY = e.pageY - lastY;
}
mapImage.translate(currentMapPosX, currentMapPosY);
lastX = e.pageX;
lastY = e.pageY;
if (mapImage.attr('x') > 0) mapImage.attr({'x': 0});
if (mapImage.attr('x') < (mapWidth - mapImage.attr('width'))) mapImage.attr({'x': (mapWidth - mapImage.attr('width'))});
if (mapImage.attr('y') > 0) mapImage.attr({'y': 0});
if (mapImage.attr('y') < (mapHeight - mapImage.attr('height') )) mapImage.attr({'y': (mapHeight - mapImage.attr('height') )});
});	
$(mapImage.node).mousedown(function(e){
e.preventDefault();
});
$(mapImage.node).mousedown(function(e){
e.preventDefault();
});
//});





}

